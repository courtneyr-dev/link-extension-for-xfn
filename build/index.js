(()=>{"use strict";const e=window.wp.i18n,t=window.wp.hooks,n=window.wp.components,o=window.wp.blockEditor,i=window.wp.compose,l=(window.wp.element,window.wp.data,window.ReactJSXRuntime),r=(...e)=>{},s={friendship:{type:"radio",label:(0,e.__)("Friendship","link-extension-for-xfn"),description:(0,e.__)("Your friendship level (choose one)","link-extension-for-xfn"),options:[{label:(0,e.__)("Contact","link-extension-for-xfn"),value:"contact"},{label:(0,e.__)("Acquaintance","link-extension-for-xfn"),value:"acquaintance"},{label:(0,e.__)("Friend","link-extension-for-xfn"),value:"friend"}]},physical:{type:"checkbox",label:(0,e.__)("Physical","link-extension-for-xfn"),description:(0,e.__)("Have you met this person?","link-extension-for-xfn"),options:[{label:(0,e.__)("Met","link-extension-for-xfn"),value:"met"}]},professional:{type:"checkbox",label:(0,e.__)("Professional","link-extension-for-xfn"),description:(0,e.__)("Professional relationships","link-extension-for-xfn"),options:[{label:(0,e.__)("Co-worker","link-extension-for-xfn"),value:"co-worker"},{label:(0,e.__)("Colleague","link-extension-for-xfn"),value:"colleague"}]},geographical:{type:"radio",label:(0,e.__)("Geographical","link-extension-for-xfn"),description:(0,e.__)("Geographical relationship","link-extension-for-xfn"),options:[{label:(0,e.__)("Co-resident","link-extension-for-xfn"),value:"co-resident"},{label:(0,e.__)("Neighbor","link-extension-for-xfn"),value:"neighbor"}]},family:{type:"radio",label:(0,e.__)("Family","link-extension-for-xfn"),description:(0,e.__)("Family relationship","link-extension-for-xfn"),options:[{label:(0,e.__)("Child","link-extension-for-xfn"),value:"child"},{label:(0,e.__)("Parent","link-extension-for-xfn"),value:"parent"},{label:(0,e.__)("Sibling","link-extension-for-xfn"),value:"sibling"},{label:(0,e.__)("Spouse","link-extension-for-xfn"),value:"spouse"},{label:(0,e.__)("Kin","link-extension-for-xfn"),value:"kin"}]},romantic:{type:"checkbox",label:(0,e.__)("Romantic","link-extension-for-xfn"),description:(0,e.__)("Romantic relationships","link-extension-for-xfn"),options:[{label:(0,e.__)("Muse","link-extension-for-xfn"),value:"muse"},{label:(0,e.__)("Crush","link-extension-for-xfn"),value:"crush"},{label:(0,e.__)("Date","link-extension-for-xfn"),value:"date"},{label:(0,e.__)("Sweetheart","link-extension-for-xfn"),value:"sweetheart"}]},identity:{type:"checkbox",label:(0,e.__)("Identity","link-extension-for-xfn"),description:(0,e.__)("Is this your own content?","link-extension-for-xfn"),options:[{label:(0,e.__)("Me","link-extension-for-xfn"),value:"me"}]}};function a(e){if(!e)return{xfn:[],other:[]};const t=["contact","acquaintance","friend","met","co-worker","colleague","co-resident","neighbor","child","parent","sibling","spouse","kin","muse","crush","date","sweetheart","me"],n=e.split(/\s+/).filter(Boolean),o=[],i=[];return n.forEach(e=>{t.includes(e)?o.push(e):i.push(e)}),{xfn:o,other:i}}function c(e,t){const n=[...t,...e].filter(Boolean);return[...new Set(n)].join(" ")}function d(e,t){return e.rel?e.rel:e.metadata?.rel?e.metadata.rel:""}const u=({attributes:t,setAttributes:i,name:r})=>{const u=d(t),{xfn:p,other:f}=a(u),b=(e,n,o)=>{let l=[...p];if("radio"===s[e].type){const t=s[e].options.map(e=>e.value);l=l.filter(e=>!t.includes(e)),o&&l.push(n)}else o?l.includes(n)||l.push(n):l=l.filter(e=>e!==n);(e=>{const n=c(e,f);!function(e,t,n){e.hasOwnProperty("rel")?t({rel:n||void 0}):t({metadata:{...e.metadata||{},rel:n||void 0}})}(t,i,n)})(l)},x=t.url||t.href||t.eventUrl,h=["core/button","core/image","core/navigation-link","core/site-logo","core/post-title","core/query-title","core/embed"].includes(r)||t.hasOwnProperty("eventUrl")||x;return(0,l.jsx)(o.InspectorControls,{children:(0,l.jsxs)(n.PanelBody,{title:(0,e.__)("XFN Relationships","link-extension-for-xfn"),initialOpen:h,className:"xfn-inspector-panel",children:[(0,l.jsx)("p",{className:"xfn-panel-description",children:(0,e.__)("Describe your relationship to the people or organizations you link to using XFN (XHTML Friends Network) markup.","link-extension-for-xfn")}),Object.entries(s).map(([t,o])=>{if("radio"===o.type){const i=o.options.find(e=>p.includes(e.value))?.value||"",r=[{label:(0,e.__)("None","link-extension-for-xfn"),value:""},...o.options];return(0,l.jsx)("div",{className:"xfn-category-section",children:(0,l.jsx)(n.RadioControl,{label:o.label,help:o.description,selected:i,options:r,onChange:e=>{b(t,e,""!==e)}})},t)}return(0,l.jsxs)("div",{className:"xfn-category-section",children:[(0,l.jsx)("h4",{className:"xfn-category-title",children:o.label}),(0,l.jsx)("p",{className:"xfn-category-help",children:o.description}),o.options.map(e=>(0,l.jsx)(n.CheckboxControl,{label:e.label,checked:p.includes(e.value),onChange:n=>{b(t,e.value,n)}},e.value))]},t)}),p.length>0&&(0,l.jsxs)("div",{className:"xfn-selected-summary",children:[(0,l.jsx)("h4",{children:(0,e.__)("Selected Relationships:","link-extension-for-xfn")}),(0,l.jsx)("div",{className:"xfn-pills",children:p.map(e=>(0,l.jsx)("span",{className:`xfn-pill xfn-pill-${e}`,children:e},e))})]})]})})};let p=[],f=[],b=null,x=null;function h(){setTimeout(()=>{const t=document.querySelector(".block-editor-link-control");if(!t)return;const n=t.querySelector(".block-editor-link-control__tools .components-button");if(!n)return;if("true"!==n.getAttribute("aria-expanded"))return;const o=t.querySelector(".block-editor-link-control__settings");if(!o)return;if(o.querySelector(".xfn-collapsible-section"))return;const i=t,l=Object.keys(i).find(e=>e.startsWith("__react"));if(l){let e=i[l],t=0;for(;e&&t<10;){if(e.memoizedProps?.value){x=e.memoizedProps.value,b=e.memoizedProps.onChange,window.currentLinkValue=x,window.currentLinkOnChange=b,r(),r(Object.keys(x)),r(x.rel),r();break}e=e.return||e._owner,t++}}o.querySelectorAll("input").forEach((e,t)=>{e.type,e.id,e.name,e.placeholder,e.value});let u=t.querySelector('input[type="text"][placeholder*="rel" i]');if(u||(u=t.querySelector('input[id*="rel" i]')),!u){const e=o.querySelectorAll('input:not([type="checkbox"]):not([type="radio"]):not([type="hidden"])');e.length>0&&(u=e[e.length-1])}u&&u.value;let h="";const m=wp.data.select("core/block-editor").getSelectedBlock(),k=m?.attributes?.url||m?.attributes?.href||m?.attributes?.eventUrl;if(m&&(["core/button","core/image","core/navigation-link","core/site-logo","core/post-title","core/query-title","core/embed"].includes(m.name)||m.attributes?.hasOwnProperty("eventUrl")||k))h=d(m.attributes,m.name);else if(x?.url&&m?.attributes?.content){let e=m.attributes.content;if("object"==typeof e&&e.toHTMLString&&(e=e.toHTMLString()),"string"==typeof e&&e.includes(x.url)){const t=(new DOMParser).parseFromString(e,"text/html"),n=Array.from(t.querySelectorAll("a")).find(e=>e.getAttribute("href")===x.url);n&&(h=n.getAttribute("rel")||"")}}!h&&x&&x.rel?h=x.rel:!h&&u&&(h=u.value);const{xfn:w,other:_}=a(h);p=[...w],f=[..._];const v=document.createElement("div");v.className="xfn-collapsible-section",v.innerHTML=function(t){let n=`\n\t\t<button \n\t\t\tclass="xfn-section-toggle components-button is-tertiary" \n\t\t\taria-expanded="false" \n\t\t\ttype="button"\n\t\t>\n\t\t\tXFN ${t.length>0?`<span class="xfn-count-badge">${t.length}</span>`:""}\n\t\t\t<svg class="xfn-chevron" width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="M17.5 11.6L12 16l-5.5-4.4.9-1.2L12 14l4.5-3.6 1 1.2z"/>\n\t\t\t</svg>\n\t\t</button>\n\t\t<div class="xfn-section-content" style="display: none;">\n\t\t\t<p class="xfn-section-description">\n\t\t\t\t${(0,e.__)("Describe your relationship to this person or organization","link-extension-for-xfn")}\n\t\t\t</p>\n\t`;return Object.entries(s).forEach(([o,i])=>{if(n+=`<div class="xfn-category" data-category="${o}">`,n+=`<h4>${i.label}</h4>`,"radio"===i.type){const o=i.options.find(e=>t.includes(e.value))?.value||"";n+='<div class="xfn-button-group">',n+=`<button class="components-button is-compact ${""===o?"is-pressed":""}" data-value="">${(0,e.__)("None","link-extension-for-xfn")}</button>`,i.options.forEach(e=>{n+=`<button class="components-button is-compact ${o===e.value?"is-pressed":""}" data-value="${e.value}">${e.label}</button>`}),n+="</div>"}else n+='<div class="xfn-button-group">',i.options.forEach(e=>{const o=t.includes(e.value);n+=`<button class="components-button is-compact ${o?"is-pressed":""}" data-value="${e.value}">${e.label}</button>`}),n+="</div>";n+="</div>"}),t.length>0&&(n+='<div class="xfn-summary">',n+=`<h4>${(0,e.__)("Active Relationships:","link-extension-for-xfn")}</h4>`,n+='<div class="xfn-pills">',t.forEach(e=>{n+=`<span class="xfn-pill xfn-pill-${e}">${e}</span> `}),n+="</div></div>"),n+="</div>",n}(p),o.appendChild(v),function(t,n){const o=t.querySelector(".xfn-section-toggle"),i=t.querySelector(".xfn-section-content"),l=o.querySelector(".xfn-chevron"),r=t.closest(".block-editor-link-control")||document;o.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation();const t=!("true"===o.getAttribute("aria-expanded"));o.setAttribute("aria-expanded",t),i.style.display=t?"block":"none",l.style.transform=t?"rotate(180deg)":"rotate(0deg)"}),t.querySelectorAll(".xfn-button-group .components-button").forEach(i=>{i.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation();const l=i.target.closest(".xfn-category").dataset.category,a=i.target.dataset.value,d=i.target.closest(".xfn-button-group");if("radio"===s[l].type){const e=s[l].options.map(e=>e.value);p=p.filter(t=>!e.includes(t)),a&&p.push(a),d.querySelectorAll(".components-button").forEach(e=>{e.classList.remove("is-pressed")}),i.target.classList.add("is-pressed")}else i.target.classList.contains("is-pressed")?(p=p.filter(e=>e!==a),i.target.classList.remove("is-pressed")):(p.includes(a)||p.push(a),i.target.classList.add("is-pressed"));(()=>{const i=c(p,f);if(n){n.value=i;const e=new Event("input",{bubbles:!0});n.dispatchEvent(e);const t=new Event("change",{bubbles:!0});n.dispatchEvent(t)}window.pendingXFNRel=i,window.pendingXFNUrl=x?.url,window.pendingXFNRel,window.pendingXFNUrl,x={...x||{},rel:i||""};const l=r.querySelector('.block-editor-link-control__search-submit, button[type="submit"]');l&&(l.removeAttribute("aria-disabled"),l.removeAttribute("disabled"),l.classList.add("xfn-apply-ready")),function(t){let n=t.querySelector(".xfn-summary");if(0===p.length)return void(n&&n.remove());n||(n=document.createElement("div"),n.className="xfn-summary",t.querySelector(".xfn-section-content").appendChild(n));let o=`<h4>${(0,e.__)("Active Relationships:","link-extension-for-xfn")}</h4>`;o+='<div class="xfn-pills">',p.forEach(e=>{o+=`<span class="xfn-pill xfn-pill-${e}">${e}</span> `}),o+="</div>",n.innerHTML=o}(t),function(e){let t=e.querySelector(".xfn-count-badge");0!==p.length?(t||(t=document.createElement("span"),t.className="xfn-count-badge",e.insertBefore(t,e.querySelector(".xfn-chevron"))),t.textContent=p.length):t&&t.remove()}(o)})()})})}(v,u),t.querySelectorAll("button");const y=t.querySelector('.block-editor-link-control__search-submit, button[type="submit"]');y&&y.addEventListener("click",e=>{if(p.length>0){const e=c(p,f);window.pendingXFNRel=e,window.pendingXFNUrl=x?.url,setTimeout(()=>{g()},100),setTimeout(()=>{g()},300),setTimeout(()=>{g()},500),setTimeout(()=>{g()},1e3)}n&&"true"===n.getAttribute("aria-expanded")&&setTimeout(()=>n.click(),150)},!0)},100)}function g(){if(window.pendingXFNRel,window.pendingXFNUrl,!window.pendingXFNRel||!window.pendingXFNUrl)return!1;const e=wp.data.select("core/block-editor").getSelectedBlock();if(!e)return!1;e.name,e.clientId,e.attributes,e.innerBlocks;const t=e.attributes?.url||e.attributes?.href||e.attributes?.eventUrl;if(["core/button","core/image","core/navigation-link","core/site-logo","core/post-title","core/query-title","core/embed"].includes(e.name)||e.attributes?.hasOwnProperty("eventUrl")||t){const t=d(e.attributes,e.name),{other:n}=a(t),{xfn:o}=a(window.pendingXFNRel),i=c(o,n);if(e.attributes.hasOwnProperty("rel"))wp.data.dispatch("core/block-editor").updateBlockAttributes(e.clientId,{rel:i||void 0});else{const t=e.attributes.metadata||{};wp.data.dispatch("core/block-editor").updateBlockAttributes(e.clientId,{metadata:{...t,rel:i||void 0}})}if(window.currentLinkOnChange&&"function"==typeof window.currentLinkOnChange)try{const e={...window.currentLinkValue||{},rel:i||""};window.currentLinkOnChange(e)}catch(e){}return window.pendingXFNRel=null,window.pendingXFNUrl=null,!0}let n=e.attributes.content;if(n&&"object"==typeof n&&n.toHTMLString&&(n=n.toHTMLString()),!n||"string"!=typeof n)return!1;if(!n.includes(window.pendingXFNUrl))return window.pendingXFNUrl,!1;try{const{xfn:t,other:o}=a(window.pendingXFNRel),i=(new DOMParser).parseFromString(n,"text/html"),l=i.querySelectorAll("a");let r=!1;if(l.forEach(e=>{if(e.getAttribute("href")===window.pendingXFNUrl){const n=e.getAttribute("rel")||"",{other:i}=a(n),l=c(t,i.length?i:o);e.setAttribute("rel",l),r=!0}}),r){const t=i.body.innerHTML;return wp.data.dispatch("core/block-editor").updateBlockAttributes(e.clientId,{content:t}),window.pendingXFNRel=null,window.pendingXFNUrl=null,setTimeout(()=>{wp.data.select("core/block-editor").getBlock(e.clientId)},100),!0}}catch(e){}return!1}const m=(0,i.createHigherOrderComponent)(e=>t=>{const{attributes:n,name:o}=t,i=window.linkexfoData?.settings||{enable_inspector_controls:!1,enable_floating_toolbar:!1},r=n.hasOwnProperty("url")||n.hasOwnProperty("href")||n.hasOwnProperty("linkDestination")||n.hasOwnProperty("eventUrl"),s=n.url||n.href||n.linkDestination||n.eventUrl;return(["core/button","core/image","core/navigation-link","core/site-logo","core/post-title","core/query-title","core/embed"].includes(o)||r||s)&&i.enable_inspector_controls?(d(n),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e,{...t}),(0,l.jsx)(u,{...t})]})):(0,l.jsx)(e,{...t})},"withXFNControls");window.linkexfoData?.settings?.enable_inspector_controls&&(0,t.addFilter)("editor.BlockEdit","xfn-link-extension/with-xfn-controls",m),(0,t.addFilter)("blocks.getSaveContent.extraProps","xfn-link-extension/add-rel-to-links",(e,t,n)=>(t.name,p.length,e)),"undefined"!=typeof document&&setTimeout(()=>{new MutationObserver(e=>{e.forEach(e=>{"childList"===e.type&&Array.from(e.addedNodes).forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&((e.classList?.contains("block-editor-link-control")||e.querySelector?.(".block-editor-link-control"))&&h(),(e.classList?.contains("block-editor-link-control__settings")||e.querySelector?.(".block-editor-link-control__settings"))&&h())}),"attributes"===e.type&&"aria-expanded"===e.attributeName&&h()})}).observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["aria-expanded"]}),document.addEventListener("click",e=>{e.target.closest(".block-editor-link-control__tools .components-button")&&setTimeout(h,50)})},1e3);const k=window.linkexfoData?.settings||{enable_inspector_controls:!1,enable_floating_toolbar:!1};k.enable_inspector_controls,k.enable_floating_toolbar})();